<!DOCTYPE HTML>
<html>
<head>
  <meta name="viewport" content="width=device-width; initial-scale=1.0; user-scalable=0;">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"  type="text/javascript"></script>
  <style>
    body {
      font-family: Arial;
      font-size: 14px;
      color: #0000B8;
      text-align: center;
    }
    .bignumber{
      font-size: 28px;
      font-weight: bold;
    }
    .smallnumber{
      color: #ADADAD;
      font-size: 12px;
    }
    

    #error { 
        background : url( error.gif ) no-repeat 50% 50%;
        width: 100%;
        height: 100px;
    }
             
  </style>
</head>
<body>
<script> 
 
  $(function() {
 
    var startPos = { coords:{ latitude: 52.529	,
                              longitude: 13.4687930
                   }};
    $('.error_type').hide();
    $('#error').hide();
    
    function showPosition( position ) {
        var lat = position.coords.latitude;
        var lon = position.coords.longitude;
        $('#currentLat').text( lat );
        $('#currentLon').text( lon );
    }

    function formatDistance( distance ) {
      var unit = "m";
      if( distance > 1000 ) {
          distance /= 1000;
          unit = "km";
      }
      var num=Math.pow(10,2);
      return (Math.round(distance*num)/num)+' '+unit;
    }
    
    if (navigator.geolocation) { 
      navigator.geolocation.getCurrentPosition(function(position) {
          showPosition( position );
      }, function(error) {
        $('#error').show();
        $('#error .error_type_'+error.code).show();
        // error.code can be:
        //   0: unknown error
        //   1: permission denied
        //   2: position unavailable (error response from locaton provider)
        //   3: timed out
      });
 
      navigator.geolocation.watchPosition(function(position) {
          showPosition( position );
        $('#distance').text ( formatDistance(
          calculateDistance(startPos.coords.latitude, startPos.coords.longitude,
                            position.coords.latitude, position.coords.longitude) )
        );
      });
    }
  });
 
  // Reused code - copyright Moveable Type Scripts - retrieved May 4, 2010.
  // http://www.movable-type.co.uk/scripts/latlong.html
  // Under Creative Commons License http://creativecommons.org/licenses/by/3.0/
  function calculateDistance(lat1, lon1, lat2, lon2) {
    var R = 6371; // km
    var dLat = (lat2-lat1).toRad();
    var dLon = (lon2-lon1).toRad(); 
    var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(lat1.toRad()) * Math.cos(lat2.toRad()) * 
            Math.sin(dLon/2) * Math.sin(dLon/2); 
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
    var d = R * c;
    return d*1000; // meters
  }
  Number.prototype.toRad = function() {
    return this * Math.PI / 180;
  }
 
</script> 
<div id="error" style="display:none">
    <div class="error_type error_type_0">irgendwas ist schief gegangen</div>
    <div class="error_type error_type_1">Du musst mir schon sagen wo du bist, sonst geht das hier nicht.</div>
    <div class="error_type error_type_2">GPS nicht verf√ºgbar</div>
    <div class="error_type error_type_3">Das dauert zu lange...</div>
    <span onClick=window.location.reload>nochmal...</span>
  </div>

  <div id="distance" class="bignumber">
  </div>
  <div id="position" class="smallnumber">
    <span id="currentLat">???</span> - <span id="currentLon">???</span>
  </div>
</body>
</html>
