<!DOCTYPE HTML>
<html>
    <head>
        <meta name="viewport" content="width=device-width;height=device-height; initial-scale=1.0; user-scalable=0;">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"  type="text/javascript"></script>
        <style type="text/css" >
            body {
                font-family: Arial;
                font-size: 14px;
                color: #0000B8;
                text-align: center;
            }
            a { text-decoration: underline; cursor: pointer; }
            .bignumber{
                font-size: 42px;
                font-weight: bold;
            }
            .smallnumber{
                color: #ADADAD;
                font-size: 12px;
            }
            .mediumnumber{
                color: #ADADAD;
                font-size: 18px;
            }
            #savebtn,
            #distance {
                padding-top: 20px;
            }

            .footer {
                position: absolute;
                bottom:10px;
            }

            #error {
                background : url( error.gif ) no-repeat 50% 15%;
                width: 100%;
                height: 100px;
                padding-top:80px;
            }

        </style>
    </head>
    <body>
        <script>
 
            $(function() {
 
                var startPos;
                var savedPos;
                var geolocOptions = {enableHighAccuracy:true, maximumAge:500};
                $('.error_type').hide();
                $('#error').hide();
                $('#savebtn').click(function(){
                    $('#savebtn').text('saving...');
                    $.post('/save.php',startPos)
                     .success(function(data){
                        $('#savebtn').text('...done');
                        savedPos=data;
                     })
                     .error(function(){
                        $('#savebtn').text('...error');
                     })
                     .complete(function(){
                        window.setTimeout(function(){
                            $('#savebtn').text('save');
                        },3000)
                     });
                    });
    
                function showPosition( position ) {
                    $('#currentLat').text( position.coords.latitude );
                    $('#currentLon').text( position.coords.longitude );
                    $('#currentErrorValue').text( position.coords.accuracy );
                    startPos=position;
                }

                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                        showPosition( position );
                    }, function(error) {
                        $('#error').show();
                        // $('#functions').hide();
                        $('#error .error_type_'+error.code).show();
                        // error.code can be:
                        //   0: unknown error
                        //   1: permission denied
                        //   2: position unavailable (error response from locaton provider)
                        //   3: timed out
                    },geolocOptions);
 
                    navigator.geolocation.watchPosition(function(position) {
                        showPosition( position );
                    },function(){},geolocOptions);
                }
            });
 
        </script>
        <div id="error" style="display:none">
            <div class="error_type error_type_0">irgendwas ist schief gegangen</div>
            <div class="error_type error_type_1">Du musst mir schon sagen wo du bist, sonst geht das hier nicht.</div>
            <div class="error_type error_type_2">GPS nicht verf√ºgbar</div>
            <div class="error_type error_type_3">Das dauert zu lange...</div>
            <a onClick="window.location.reload();">nochmal...</a>
        </div>

        <div id="functions">
            <div id="savebtn" class="bignumber">save</div>

            <div id="position" class=" mediumnumber">
                <span id="currentLat">???</span> - <span id="currentLon">???</span>
            </div>
            <div id="currentError" class="mediumnumber">
                +- <span id="currentErrorValue">???</span>m
            </div>
        </div>
    </body>
</html>
